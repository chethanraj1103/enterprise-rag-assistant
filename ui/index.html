<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Enterprise RAG Assistant</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
        }

        h1 {
            margin-bottom: 5px;
        }

        .card {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
        }

        button {
            padding: 10px 14px;
            cursor: pointer;
        }

        .answer {
            white-space: pre-wrap;
            background: #fafafa;
            padding: 12px;
            border-radius: 8px;
        }

        .sources {
            color: #555;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <h1>Enterprise Knowledge Assistant (RAG)</h1>
    <p>Upload documents and ask questions grounded in your data.</p>

    <div class="card">
        <h3>Admin â€“ Upload PDF</h3>
        <form id="uploadForm" enctype="multipart/form-data">
            <input type="file" name="file" />
            <button type="submit">Upload & Index</button>
            <span id="uploadStatus"></span>
        </form>
    </div>

    <div class="card">
        <h3>Ask a Question</h3>
        <input type="text" id="question" placeholder="Ask something about the uploaded documents..." />
        <br /><br />
        <button onclick="ask()">Ask</button>

        <h4>Answer</h4>
        <div id="answer" class="answer"></div>

        <h4>Sources</h4>
        <div id="sources" class="sources"></div>
    </div>

    <script>
        async function ask() {
            const q = document.getElementById("question").value;
            document.getElementById("answer").innerText = "Thinking...";
            document.getElementById("sources").innerText = "";

            const formData = new FormData();
            formData.append("question", q);

            const res = await fetch("/ask", { method: "POST", body: formData });
            const data = await res.json();

            document.getElementById("answer").innerText = data.answer || "";
            document.getElementById("sources").innerText = (data.sources || []).join(", ");
        }

        document.getElementById("uploadForm").onsubmit = async (e) => {
            e.preventDefault();
            const status = document.getElementById("uploadStatus");
            status.innerText = "Indexing...";
            const formData = new FormData(e.target);

            const res = await fetch("/upload", {
                method: "POST",
                headers: { "X-Role": "admin" },
                body: formData
            });

            const data = await res.json();
            status.innerText = `Indexed ${data.chunks_indexed} chunks`;
        };
    </script>
</body>

</html>